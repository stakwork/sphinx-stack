# alternate clusters

### no alice relay

Use this to develop on sphinx-relay

```
docker-compose -f ./alts/no-alice.yml --project-directory . up -d
```

Then in sphinx-relay:
 - find `testing/stack/alice.json`:
    - change `tls_location` to point back to the cert generated by stack
    - change `macaroon_location` to point back to the macaroon generated by stack
 - and `testing/stack/alice-db.json`:
    - change `storage`  to point to alice's DB file generated by stack
 - then run:
```
*be sure to update the alice.json and alice-db.json files with your project dir and make sure to use the full path*
node ./dist/app.js --config="testing/stack/alice.json" --db="testing/stack/alice-db.json"
```

### no tribes server or frontend

Use this to develop on sphinx tribes server and frontend

```
docker-compose -f ./alts/no-tribes.yml --project-directory . up -d

### proxy testing

in sphinx-proxy dir
docker build --no-cache -t sphinx-proxy .

docker-compose -f ./alts/proxy.yml --project-directory . up -d

```

### LSAT-based paywall

To use [aperture](https://docs.lightning.engineering/the-lightning-network/lsat/aperture)
as a way to protect certain endpoints in meme server using lightning enabled
LSATs, you can use the alt `alts/lsat.yml` config with the normal base compose.
By default the configuration assumes that alice's node will be used to generate
invoices protecting endpoints. This (and other items) can be configured via another
yaml file for the aperture configurations in `aperture/aperture.yaml`

Some configs to look at for more customization:

- `listenaddr` - for where the proxy is accessible from
- `authenticator` - lightning node configurations including host and where credentials can be found
- `services` - a list of services that will be protected by aperture.
  These have other options that can be used to customize the endpoint and protection conditions

To run sphinx stack with aperture:

```
docker compose -f docker-compose.yml -f ./alts/lsat.yml --project-directory . up -d
```

#### Local Development with Meme
There is also a special service and profile in the main docker compose file
that allows for running with a local development instance of a service. 
By commenting out one of the `depends_on` services listed in the `exclude-services`
service, everything but that service or services will be run. 

Furthermore, by using `profiles` you can make services that will only run with that
specific profile passed. For example, to run a local meme for developing against,
comment out `meme` from the exclude-services list, and then run:

```
$  docker compose -f docker-compose.yml --profile aperture --project-directory . up exclude-services
```

Once your meme server is running and connected to the other services, everything should be working.
